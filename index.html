<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rotational Motion | JEE Racing</title>
    <style>
        :root {
            --bg: #18181b;
            --panel: rgba(39, 39, 42, 0.95);
            --primary: #f59e0b; /* Amber */
            --accent: #ef4444; /* Red */
            --text: #f4f4f5;
            --border: rgba(255,255,255,0.1);
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', system-ui, sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        /* --- HUD --- */
        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* --- LEADERBOARD --- */
        .leaderboard {
            margin: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            border: 1px solid var(--border);
            pointer-events: auto;
            max-width: 250px;
        }
        .lb-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #a1a1aa;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .lb-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 6px;
            align-items: center;
        }
        .lb-name { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .lb-val { font-family: monospace; color: var(--primary); }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }

        /* --- BOTTOM DOCK --- */
        .dock {
            background: var(--panel);
            padding: 15px;
            padding-bottom: max(15px, env(safe-area-inset-bottom));
            display: flex;
            gap: 12px;
            pointer-events: auto;
            border-top: 1px solid var(--border);
            align-items: center;
        }

        .btn-icon {
            width: 48px; height: 48px;
            background: #3f3f46;
            border-radius: 12px;
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-icon.active { background: var(--primary); color: black; }

        .btn-race {
            flex: 1;
            height: 48px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: none;
            border-radius: 12px;
            color: black;
            font-weight: 800;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        .btn-race:active { transform: scale(0.98); }

        /* --- SETTINGS MENU --- */
        .settings {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            background: #18181b;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            padding-bottom: 100px; /* clear dock */
            box-sizing: border-box;
            transform: translateY(110%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            border-top: 2px solid var(--primary);
            box-shadow: 0 -10px 50px rgba(0,0,0,0.8);
            z-index: 5;
        }
        .settings.open { transform: translateY(0); }

        .control-group { margin-bottom: 20px; }
        .label-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; color: #a1a1aa; }
        .val-disp { color: var(--primary); font-weight: bold; font-family: monospace; }
        
        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 6px; background: #3f3f46; border-radius: 3px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 22px; height: 22px; background: white; border-radius: 50%; cursor: pointer; border: 2px solid var(--primary);
        }

        .hint {
            margin-top: 15px; padding: 10px; background: rgba(245,158,11,0.1); border-left: 3px solid var(--primary);
            font-size: 0.8rem; color: #d4d4d8; line-height: 1.4;
        }

    </style>
</head>
<body>

<canvas id="sim"></canvas>

<div id="hud">
    <div class="leaderboard">
        <div class="lb-title">Live Race Data</div>
        <div id="lb-content">
            </div>
    </div>

    <div class="settings" id="settings-menu">
        <div class="label-row" style="margin-bottom:20px;">
            <span style="font-size:1.2rem; font-weight:bold; color:white;">Track Conditions</span>
            <button onclick="toggleSettings()" style="background:none; border:none; color:#666; font-size:1.5rem;">‚úï</button>
        </div>

        <div class="control-group">
            <div class="label-row"><span>Ramp Angle ($\theta$)</span> <span id="disp-angle" class="val-disp">30¬∞</span></div>
            <input type="range" min="10" max="60" value="30" oninput="updateParam('angle', this.value)">
        </div>

        <div class="control-group">
            <div class="label-row"><span>Gravity ($g$)</span> <span id="disp-g" class="val-disp">9.8 m/s¬≤</span></div>
            <input type="range" min="1" max="25" value="9.8" step="0.1" oninput="updateParam('g', this.value)">
        </div>
        
        <div class="control-group">
            <div class="label-row"><span>Radius (Visual Only)</span> <span id="disp-r" class="val-disp">1.0x</span></div>
            <input type="range" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateParam('r', this.value)">
        </div>

        <div class="hint">
            <strong>JEE Concept:</strong> Acceleration $a = \frac{g\sin\theta}{1 + I/MR^2}$.<br>
            Notice that Mass and Radius are <strong>not</strong> in the formula! All objects of the same shape accelerate equally regardless of size.
        </div>
    </div>

    <div class="dock">
        <button class="btn-icon" onclick="toggleSettings()" id="btn-set">‚öôÔ∏è</button>
        <button class="btn-icon" onclick="reset()">‚Ü∫</button>
        <button class="btn-race" onclick="startRace()">START RACE üèÅ</button>
    </div>
</div>

<script>
/**
 * ROTATIONAL RACING ENGINE
 * Simulates pure rolling on an inclined plane.
 */

const canvas = document.getElementById('sim');
const ctx = canvas.getContext('2d');

let width, height;
let ramp = { x: 0, y: 0, length: 0, angle: 30 }; // Calculated in resize
let racers = [];
let running = false;
let finished = false;
let settingsOpen = false;

// Physics Params
let params = {
    g: 9.8,
    angle: 30,
    radiusScale: 1.0
};

// Shape Definitions (I = k * MR^2)
const SHAPES = [
    { name: 'Solid Sphere', k: 0.4, color: '#10b981' }, // 2/5
    { name: 'Disc / Cylinder', k: 0.5, color: '#3b82f6' }, // 1/2
    { name: 'Hollow Sphere', k: 0.66, color: '#f59e0b' }, // 2/3
    { name: 'Ring / Hoop', k: 1.0, color: '#ef4444' }     // 1
];

// --- SETUP ---
function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    reset();
}
window.addEventListener('resize', resize);

function toggleSettings() {
    settingsOpen = !settingsOpen;
    document.getElementById('settings-menu').classList.toggle('open', settingsOpen);
    document.getElementById('btn-set').classList.toggle('active', settingsOpen);
}

function updateParam(key, val) {
    val = parseFloat(val);
    if(key === 'angle') { params.angle = val; document.getElementById('disp-angle').innerText = val + '¬∞'; reset(); }
    if(key === 'g') { params.g = val; document.getElementById('disp-g').innerText = val + ' m/s¬≤'; }
    if(key === 'r') { 
        params.radiusScale = val; 
        document.getElementById('disp-r').innerText = val + 'x';
        // Update existing radius visual
        racers.forEach(r => r.radius = 25 * params.radiusScale);
    }
}

// --- RACER CLASS ---
class Racer {
    constructor(def, index) {
        this.name = def.name;
        this.k = def.k; // The inertia constant
        this.color = def.color;
        
        // Visuals
        this.radius = 25 * params.radiusScale;
        this.index = index; // Lane index
        
        // Physics State (Distance along ramp)
        this.d = 0; 
        this.v = 0;
        this.theta = 0; // Rotation angle
        this.finished = false;
    }

    update(dt) {
        if(this.finished) return;

        // ACCELERATION FORMULA: a = (g * sin(theta)) / (1 + k)
        const rad = params.angle * (Math.PI / 180);
        const acc = (params.g * Math.sin(rad)) / (1 + this.k);
        
        // Physics Integration scale
        // We use pixels as meters for calculation, but display differently
        const SCALE = 20; // 20px = 1m logic
        
        this.v += acc * dt;
        this.d += this.v * dt * SCALE; // Distance in pixels

        // Rotation (Pure Rolling Condition: v = w * r)
        // dTheta = (v * dt) / r
        this.theta += (this.v * dt * SCALE) / this.radius;

        // Finish Line Check
        if (this.d >= ramp.length) {
            this.d = ramp.length;
            this.finished = true;
        }
    }

    draw(ctx) {
        // Calculate screen position based on Ramp Angle
        const rad = params.angle * (Math.PI / 180);
        
        // Start position (Top Left of ramp)
        const startX = ramp.x;
        const startY = ramp.y;

        // Lane Offset (spread them perpendicular to movement not possible in 2D side view)
        // So we just draw them on the same line but slightly offset vertically?
        // No, let's draw "Ghost" lanes.
        // Or better: Draw them stacked vertically, but simulating the same ramp.
        
        // Let's do distinct "shelves" for each racer so they don't overlap visually
        // Each shelf is parallel.
        const shelfGap = 80;
        const myShelfY = startY + (this.index * shelfGap);
        const myShelfX = startX; // We can shift X slightly for aesthetic if needed

        // Current Pos
        const px = myShelfX + this.d * Math.cos(rad);
        const py = myShelfY + this.d * Math.sin(rad);

        // Draw Ramp Line for this racer
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(myShelfX, myShelfY + this.radius); // Draw floor below ball
        const endX = myShelfX + ramp.length * Math.cos(rad);
        const endY = myShelfY + ramp.length * Math.sin(rad) + this.radius;
        ctx.lineTo(endX, endY);
        ctx.stroke();

        // Draw Racer
        ctx.save();
        ctx.translate(px, py);
        ctx.rotate(this.theta); // Spin!

        ctx.beginPath();
        ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
        
        // Fill Styles based on type to show rotation
        ctx.fillStyle = this.color;
        
        if (this.name.includes('Ring')) {
            ctx.strokeStyle = this.color;
            ctx.lineWidth = 4;
            ctx.stroke();
            // Spokes
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(this.radius, 0); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(-this.radius, 0); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, this.radius); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, -this.radius); ctx.stroke();
        } else if (this.name.includes('Hollow')) {
             ctx.fillStyle = 'transparent';
             ctx.strokeStyle = this.color;
             ctx.lineWidth = this.radius * 0.4; // Thick shell
             ctx.stroke();
             // Marker to see rotation
             ctx.fillStyle = 'white';
             ctx.beginPath(); ctx.arc(this.radius*0.6, 0, 3, 0, Math.PI*2); ctx.fill();
        } else {
            // Solid
            ctx.fill();
            // Stripe to see rotation
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.fillRect(-this.radius, -2, this.radius*2, 4);
            ctx.fillRect(-2, -this.radius, 4, this.radius*2);
        }

        ctx.restore();

        // Label
        ctx.fillStyle = '#aaa';
        ctx.font = '10px sans-serif';
        ctx.fillText(this.name, startX, myShelfY - 10);
    }
}

// --- MAIN LOOP ---

function reset() {
    running = false;
    finished = false;
    
    // Define ramp geometry
    const padding = 50;
    const laneHeight = 80;
    const totalH = laneHeight * 4;
    
    // Start top left
    ramp.x = padding;
    ramp.y = (height - totalH) / 2; // Center vertically
    // Length depends on width and angle, keep it within screen
    // cos(angle) * len < width - padding*2
    const rad = params.angle * (Math.PI/180);
    const maxLen = (width - padding*2) / Math.cos(rad);
    ramp.length = Math.min(maxLen, 800);

    // Initialize Racers
    racers = SHAPES.map((def, i) => new Racer(def, i));
    updateLeaderboard();
}

function startRace() {
    if(running) return;
    running = true;
    if(settingsOpen) toggleSettings();
}

function updateLeaderboard() {
    const html = racers
        .sort((a, b) => b.d - a.d) // Sort by distance traveled
        .map((r, i) => {
            // Calculate real acceleration for display
            const rad = params.angle * (Math.PI / 180);
            const a = (params.g * Math.sin(rad)) / (1 + r.k);
            
            return `
            <div class="lb-row">
                <div class="lb-name">
                    <span style="color:#666">${i+1}.</span>
                    <span class="dot" style="background:${r.color}"></span>
                    ${r.name}
                </div>
                <div class="lb-val">${a.toFixed(1)} m/s¬≤</div>
            </div>`;
        }).join('');
    
    document.getElementById('lb-content').innerHTML = html;
}

let lastTime = 0;
function loop(timestamp) {
    const dt = Math.min((timestamp - lastTime) / 1000, 0.1); // Cap dt
    lastTime = timestamp;

    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
    ctx.fillRect(0, 0, width, height);

    // Background Grid Hint
    ctx.strokeStyle = '#222';
    ctx.lineWidth = 1;
    ctx.beginPath();
    for(let i=0; i<width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,height); }
    ctx.stroke();

    if (running) {
        let allDone = true;
        racers.forEach(r => {
            r.update(dt);
            if (!r.finished) allDone = false;
        });
        if(allDone) running = false;
        updateLeaderboard();
    }

    racers.forEach(r => r.draw(ctx));

    requestAnimationFrame(loop);
}

// Boot
resize();
requestAnimationFrame(loop);

</script>
</body>
</html>
